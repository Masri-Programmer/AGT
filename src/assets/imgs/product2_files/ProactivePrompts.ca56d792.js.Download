((self||this)["webpackJsonp@sprinklr/chat-web-client"]=(self||this)["webpackJsonp@sprinklr/chat-web-client"]||[]).push([[55],{1118:function(e,t,r){"use strict";var n=r(262);const c=r.n(n).a.createContext(void 0);t.a=c},1119:function(e,t,r){var n=r(80),c=r(1649),a=r(72),s=r(127),i=r(1650),u=r(325),o=s((function(e){var t=u(e),r=n(e,i);return t===u(r)?t=void 0:r.pop(),r.length&&r[0]===e[0]?c(r,a(t,2)):[]}));e.exports=o},1649:function(e,t,r){var n=r(132),c=r(716),a=r(837),s=r(80),i=r(83),u=r(133),o=Math.min;e.exports=function(e,t,r){for(var l=r?a:c,b=e[0].length,O=e.length,d=O,E=Array(O),T=1/0,v=[];d--;){var _=e[d];d&&t&&(_=s(_,i(t))),T=o(_.length,T),E[d]=!r&&(t||b>=120&&_.length>=120)?new n(d&&_):void 0}_=e[0];var j=-1,I=E[0];e:for(;++j<b&&v.length<T;){var g=_[j],h=t?t(g):g;if(g=r||0!==g?g:0,!(I?u(I,h):l(v,h,r))){for(d=O;--d;){var C=E[d];if(!(C?u(C,h):l(e[d],h,r)))continue e}I&&I.push(h),v.push(g)}}return v}},1650:function(e,t,r){var n=r(143);e.exports=function(e){return n(e)?e:[]}},1950:function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return Ht}));var n=r(262),c=r.n(n),a=r(378),s=r.n(a),i=r(263),u=r(40),o=r.n(u),l=r(344),b=r.n(l),O=r(438),d=r.n(O),E=r(380),T=r.n(E),v=r(461),_=r(320),j=r(1030),I=r(602),g=r(573),h=r(337),C=r(387);const p="IDLE",f="TRACKING";var m=()=>{const{subscribe:e}=Object(g.a)(),t=Object(n.useCallback)((()=>({eventType:C.a.PAGE_VISIT,eventId:c.current,details:{title:Object(h.c)(),oldUrl:c.current,newUrl:a.current}})),[]),r=Object(j.useFirstMountState)(),c=Object(n.useRef)(""),a=Object(n.useRef)(Object(h.b)()),{loading:s,refetch:i}=Object(I.a)({payload:t(),skipQueryOnMount:!1});return Object(n.useEffect)((()=>{const r=e("pageVisitTrackerInPrompt",(e=>{let{currentUrl:r,previousUrl:n}=e;c.current=n,a.current=r,i(t())}));return()=>{r&&r()}}),[i]),{trackingStatus:r||s?f:p}},S=r(315);var R=()=>{const{refetch:e}=Object(I.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{e({eventType:C.a.TAB_CHANGE,eventId:Object(h.b)(),details:{isActive:Object(S.d)()}})};return document.addEventListener("visibilitychange",t),()=>{document.removeEventListener("visibilitychange",t)}}),[e])};var y=()=>{const{refetch:e}=Object(I.a)({skipQueryOnMount:!0});Object(n.useEffect)((()=>{const t=()=>{e({eventType:C.a.TAB_CLOSE,eventId:Object(h.b)(),details:{}})};return window.addEventListener("beforeunload",t),()=>{window.removeEventListener("beforeunload",t)}}),[e])};var N=()=>(R(),y(),m()),A=r(293),L=r(313),k=r(2),P=r(398),D=r(426);const U=(new A.a).setUrl("/livechat/prompt/candidatePrompts").setType(L.a.POST).build(),V="ADD",w="REMOVE",G="RESET";var M=()=>{const{data:e,refetch:t,fetchMore:r,updateQuery:c}=Object(_.a)({query:U,skipQueryOnMount:!0}),a=N().trackingStatus===p,[s,i]=Object(n.useState)(a?void 0:{isSilent:!1}),u=Object(n.useContext)(v.a),o=Object(n.useRef)(a);o.current=a;const l=Object(n.useCallback)((e=>{if(!o.current)return i({isSilent:e}),null;return t({...Object(h.a)(),appId:Object(k.a)().appId},e?(e,t)=>b()(t,(e=>{const t=u.getActionState(e.interceptId,e.id);return t!==D.a.CLOSE&&t!==D.a.ENGAGE&&t!==D.a.SNOOZE})):void 0)}),[t]),O=Object(n.useCallback)((e=>o.current?r({...Object(h.a)(),appId:Object(k.a)().appId,...e},((e,t)=>d()([...e,...t],"id"))):(i({isSilent:!1}),null)),[]);Object(n.useEffect)((()=>{a&&s&&(l(s.isSilent),i(void 0))}),[a,s]);return[e,Object(n.useCallback)((e=>{switch(e.type){case V:return O(e.payload);case w:{const t=new Set(T()(e.payload.interceptIds));return c((e=>b()(e,(e=>!t.has(P.a.getId(e)))))),null}case G:return l(e.payload.silent);default:return null}}),[c])]},x=r(879),H=r(962),F=r(345),$=r(70);const B=e=>`PROMPT_${F.a.getId(e)}_${Date.now()}_${Math.random().toString(16).substr(2,8)}`;let Q;const W=()=>Q,Z=()=>{W().disconnect().then((()=>{Object($.a)("MQTT Client | Disconnected")})).catch((e=>{console.error("MQTT Client | Disconnection Error",e)}))};var Y=r(66),z=r(409);const K="ADD_INTERCEPT",J="REMOVE_INTERCEPT";var X=(e,t)=>{const r=Object(n.useMemo)((()=>({chatUser:z.a.getChatUser(t),userName:z.a.getChatSessionToken(t),inboxServerUrl:z.a.getProactiveInboxServerUrl(t),userInbox:z.a.getProactiveUserInbox(t)})),[t.chatUser,t.chatSessionToken,t.proactivePromptInboxServerUrl,t.proactiveUserInbox]);Object(n.useEffect)((()=>{(e=>{let{chatUser:t,userName:r,inboxServerUrl:n,userInbox:c}=e;const a=B(t);Q=new H.a({userName:r,clientId:a,inboxServerUrl:n,userInbox:c})})(r);try{(()=>{W().connect().catch((e=>{console.error("MQTT Client | Connection Error",e)}));const e=W();e.on("error",(()=>{Object($.a)("MQTT Client | Error")})),e.on("offline",(()=>{Object($.a)("MQTT Client | Offline")})),e.on("reconnect",(()=>{Object($.a)("MQTT Client | Reconnect")})),e.on("close",(()=>{Object($.a)("MQTT Client | Closed")}))})(),W().subscribe().catch((e=>{console.error("MQTT client | Subscribe Error",e)})),W().on("message",((t,r)=>{try{const t=JSON.parse(r.toString());e(t)}catch(n){Object(Y.b)(n)}}))}catch(t){Object(Y.b)(t),Z()}return()=>{try{W().unsubscribe()}catch(e){Object(Y.b)(e)}finally{Z()}}}),[r,e])},q=r(291),ee=r.n(q),te=r(1053);const re=c.a.createContext({debug:ee.a,info:ee.a,warning:ee.a,error:ee.a}),ne=e=>{let{children:t}=e;const r=Object(x.a)().chatUser,n=F.a.getId(r),c=Object(te.a)({category:"PROACTIVE_PROMPT",userId:n,batch:!0});return Object(i.jsx)(re.Provider,{value:c},t)},ce=()=>Object(n.useContext)(re);var ae=r(327);var se=()=>{const{subscribe:e}=Object(g.a)(),t=Object(x.a)(),[r,c]=M(),a=ce(),s=Object(k.b)();Object(n.useEffect)((()=>{c({type:G,payload:{}})}),[c,t]);const i=Object(n.useCallback)((e=>{switch(e.payload.type){case K:c({type:V,payload:{variables:e.payload.variables}});break;case J:c({type:w,payload:{interceptIds:e.payload.interceptIds}})}}),[c]);return X(i,t),Object(n.useEffect)((()=>{const t=e("fetchCandidatePromptBaseOnUrlChange",(()=>{c({type:G,payload:{silent:!0}})}));return()=>{t&&t()}}),[c]),Object(n.useEffect)((()=>{const e=e=>{if(e.response&&e.response.data&&e.response.data.eventType===ae.a.USER_PROFILE_UPDATED.id)return c({type:G,payload:{silent:!0}})};return s.sprChat("subscribeToUpdate",{topic:"eventTriggered",subscriber:e}),()=>{s.sprChat("unsubscribeToUpdate",{topic:"eventTriggered",subscriber:e})}}),[c]),Object(n.useEffect)((()=>{const e=b()(r,(e=>!P.a.getCreativeId(e)));o()(e)||a.debug(`Available intercepts : ${JSON.stringify(e)}`)}),[r]),[r,c]},ie=r(67),ue=r.n(ie),oe=r(436),le=r(410);var be=e=>{const t=ce(),r=Object(n.useMemo)((()=>ue()(e,(e=>{let t=e;return P.a.getSnoozeConfig(e)&&(t=(e=>{const t=P.a.getFilter(e),r=P.a.getSnoozeConfig(e);if(o()(r))return e;const n={filterType:oe.a.LTE,field:le.a.NUM_SNOOZE_ALLOWED,values:[r.maxSnoozeCount],details:{numSnoozes:r.maxSnoozeCount-r.currentSnoozeCount,nextSnoozeDuration:r.nextSnoozeDuration}};return t?{...e,filter:{filterType:oe.a.AND,filters:[n,t]}}:{...e,filter:n}})(t)),t}))),[e]);return Object(n.useEffect)((()=>{const e=b()(r,(e=>!P.a.getCreativeId(e)));o()(e)||t.debug(`Adapted intercepts : ${JSON.stringify(e)}`)}),[r]),r},Oe=r(1119),de=r.n(Oe),Ee=r(16),Te=r.n(Ee),ve=r(422),_e=r.n(ve);const je=new Set([le.a.IS_CONVERSATION_OPEN]),Ie="EXCLUDE_LIVE_CHAT_FILTERS",ge="INCLUDE_LIVE_CHAT_FILTERS",he=(e,t)=>{if(!o()(e)){if(e.filterType===oe.a.AND||e.filterType===oe.a.OR){if(o()(e.filters))return;const r=_e()(ue()(e.filters,(e=>he(e,t))));return o()(r)?void 0:{...e,filters:r}}return t===ge&&je.has(e.field)||t===Ie&&!je.has(e.field)?e:void 0}};var Ce=r(1031),pe=r(303);var fe=()=>{const{subscribe:e,getValue:t}=Object(g.a)();return{subscribe:Object(n.useCallback)(((t,r)=>{const n=pe.a.getId(t);return e(n,r)}),[e]),getValue:t}},me=r(299),Se=r.n(me),Re=r(301),ye=r.n(Re),Ne=r(116),Ae=r.n(Ne);var Le=class{constructor(){this._startTime=void 0,this._endTime=void 0,this.start=()=>(this._startTime=this.getCurrentTime(),this._startTime),this.stop=()=>(this._endTime=this.getCurrentTime(),this._endTime),this.getCurrentTime=()=>Date.now(),this.getStartTime=()=>this._startTime,this.getEndTime=()=>this._endTime,this._startTime=0,this._endTime=0}};var ke=class{constructor(){this._clockInstance=void 0,this._totalTime=void 0,this.time=()=>(this._totalTime=this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime(),this._totalTime),this._clockInstance=new Le,this._totalTime=0,this._clockInstance.start()}};var Pe=()=>Object(n.useCallback)((e=>{let{startTime:t,expectedTime:r,onTimeout:n}=e;const c=r-(t||Date.now());let a;return c>0&&(a=window.setTimeout((()=>{n()}),c)),a}),[]);var De=()=>{const e=Pe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new ke),[]);const r=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((n,c)=>{const a=pe.a.getId(n),s=e({startTime:t.current.time(),expectedTime:ye()(pe.a.getValues(n)),onTimeout:c});return s&&(r.current={...r.current,[a]:{timeoutId:s}}),()=>{clearTimeout(Ae()(r.current,`${a}.timeoutId`)),r.current=Se()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}},Ue=r(69),Ve=r.n(Ue);var we=class{constructor(){this._clockInstance=void 0,this._activeTime=void 0,this._visibilityChangeHandler=()=>{const e=Object(S.d)();e||(this._clockInstance.stop(),this._activeTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime()),e&&this._clockInstance.start()},this.time=()=>Object(S.d)()?this._activeTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()):this._activeTime,this._clockInstance=new Le,Object(S.d)()&&this._clockInstance.start(),this._activeTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var Ge=()=>{const e=Pe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new we),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{const n=Object(S.d)();n&&Ve()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:ye()(pe.a.getValues(Ae()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})})),n||Ve()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=pe.a.getId(n),s=Object(S.d)();if(s){const s=e({startTime:t.current.time(),expectedTime:ye()(pe.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return s||(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout(Ae()(r.current,`${a}.timeoutId`)),r.current=Se()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}};var Me=class{constructor(){this._clockInstance=void 0,this._inactiveTime=void 0,this._visibilityChangeHandler=()=>{const e=Object(S.d)();e||this._clockInstance.start(),e&&(this._clockInstance.stop(),this._inactiveTime+=this._clockInstance.getEndTime()-this._clockInstance.getStartTime())},this.time=()=>Object(S.d)()?this._inactiveTime:this._inactiveTime+(this._clockInstance.getCurrentTime()-this._clockInstance.getStartTime()),this._clockInstance=new Le,Object(S.d)()||this._clockInstance.start(),this._inactiveTime=0,document.addEventListener("visibilitychange",this._visibilityChangeHandler)}};var xe=()=>{const e=Pe(),t=Object(n.useRef)();t.current=Object(n.useMemo)((()=>new Me),[]);const r=Object(n.useRef)({}),c=Object(n.useCallback)((()=>{const n=Object(S.d)();n&&Ve()(r.current,(e=>{const{timeoutId:t}=e;t&&window.clearTimeout(t)})),n||Ve()(r.current,((n,c)=>{const{onChangeCallback:a}=n,s=e({startTime:t.current.time(),expectedTime:ye()(pe.a.getValues(Ae()(n,"filter"))),onTimeout:a});s&&(r.current={...r.current,[c]:{...r.current[c],timeoutId:s}})}))}),[]);Object(n.useEffect)((()=>(document.addEventListener("visibilitychange",c),()=>{document.removeEventListener("visibilitychange",c)})),[]);return{subscribe:Object(n.useCallback)(((n,c)=>{const a=pe.a.getId(n),s=Object(S.d)();if(!s){const s=e({startTime:t.current.time(),expectedTime:ye()(pe.a.getValues(n)),onTimeout:c});s&&(r.current={...r.current,[a]:{timeoutId:s,filter:n,onChangeCallback:c}})}return s&&(r.current={...r.current,[a]:{filter:n,onChangeCallback:c}}),()=>{clearTimeout(Ae()(r.current,`${a}.timeoutId`)),r.current=Se()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>t.current.time()),[])}};const He=(e,t)=>Te()(e,((e,r,n)=>{const c=r.variants.filter((e=>e.actionState===t));return o()(c)||(r.variants=c,e[n]=r),e}),{});var Fe=()=>{const e=Object(n.useRef)({}),t=Object(n.useContext)(v.a);return{subscribe:Object(n.useCallback)(((r,n)=>{const c=pe.a.getId(r),a=ye()(pe.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===D.a.ENGAGE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=Ae()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=Se()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>He(t.getActionDetails(),D.a.ENGAGE)),[])}};var $e=()=>{const e=Object(n.useRef)({}),t=Object(n.useContext)(v.a);return{subscribe:Object(n.useCallback)(((r,n)=>{const c=pe.a.getId(r),a=ye()(pe.a.getValues(r));if(!t.getActionState(a)){const r=t.setSubscriber(a,(e=>{e===D.a.CLOSE&&n()}));e.current={...e.current,[c]:{unsubscribeInterceptActionEvent:r}}}return()=>{const t=Ae()(e.current,`${c}.unsubscribeInterceptActionEvent`);t&&t(),e.current=Se()(e.current,c)}}),[]),getValue:Object(n.useCallback)((()=>He(t.getActionDetails(),D.a.CLOSE)),[])}};var Be=()=>{const{getValue:e,subscribe:t}=Fe(),{getValue:r,subscribe:c}=$e(),a=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,n,c)=>{const s=pe.a.getId(t);switch(c&&pe.a.getField(c)){case le.a.INTERCEPT_CLOSED_IN_SESSION_KEY:{const e=r(),i=ye()(pe.a.getValues(c)),u=()=>{const r=ye()(pe.a.getValues(t)),c=e[i]?e[i].variants:[],u=c[c.length-1].actionTime,o=r-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};e[i]&&u();break}case le.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:{const r=e(),i=ye()(pe.a.getValues(c)),u=()=>{const e=ye()(pe.a.getValues(t)),c=r[i]?r[i].variants:[],u=c[c.length-1].actionTime,o=e-(Date.now()-u);let l;o>0&&(l=window.setTimeout((()=>{n()}),o),a.current={...a.current,[s]:[()=>clearTimeout(l)]})};r[i]&&u();break}}return()=>{ue()(a.current[s],(e=>e())),a.current=Se()(a.current,s)}}),[])}},Qe=r(1037),We=r(1039);var Ze=r(350),Ye=r.n(Ze);var ze=()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=pe.a.getId(t),{start:c,end:a}=Ae()(t,"details.range[0]");let s,i;const u=c,o=Ye()(a)?-1:a;return u>0&&(s=window.setTimeout(r,u)),o>0&&(i=window.setTimeout(r,o)),e.current={...e.current,[n]:{...e.current[n],timeoutIdToGetInRange:s,timeoutIdToGetOutFromRange:i,timerStartTime:Date.now()}},()=>{clearTimeout(Ae()(e.current,`${n}.timeoutIdToGetInRange`)),clearTimeout(Ae()(e.current,`${n}.timeoutIdToGetOutFromRange`)),e.current=Se()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=pe.a.getId(t),{start:n,end:c}=Ae()(t,"details.range[0]"),a=Ae()(e.current,`${r}.timerStartTime`),s=Date.now()-a;return Ye()(n)||Ye()(c)?Ye()(n)||s>=n?0:1:s>=c?1:s>=n?0:1}),[])}};var Ke=()=>{const{getValue:e,subscribe:t}=fe(),{getValue:r,subscribe:c}=De(),{getValue:a,subscribe:s}=Ge(),{getValue:i,subscribe:u}=xe(),{getValue:o,subscribe:l}=$e(),{getValue:b,subscribe:O}=Fe(),{subscribe:d}=Be(),{getValue:E,subscribe:T}=Object(Qe.a)(),{getValue:v,subscribe:_}=Object(We.a)(),{getValue:j,subscribe:I}=(()=>{const e=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((t,r)=>{const n=pe.a.getId(t),c=ye()(pe.a.getValues(t));let a;return c>0&&(a=window.setTimeout((()=>{e.current={...e.current,[n]:{...e.current.id,timeLeft:0}},r()}),c)),e.current={...e.current,[n]:{timeoutId:a,timeLeft:c}},()=>{window.clearTimeout(Ae()(e.current,`${n}.timeoutId`)),e.current=Se()(e.current,n)}}),[]),getValue:Object(n.useCallback)((()=>t=>{const r=pe.a.getId(t);return Ae()(e.current,`${r}.timeLeft`,0)}),[])}})(),{getValue:g,subscribe:h}=(()=>{const e=Pe(),t=Object(n.useRef)(new ke),r=Object(n.useRef)({});return{subscribe:Object(n.useCallback)(((n,c)=>{const a=pe.a.getId(n),s=Ae()(pe.a.getDetails(n),"nextSnoozeDuration",0),i=t.current.time(),u=e({startTime:i,expectedTime:i+s,onTimeout:()=>{r.current={...r.current,[a]:{...r.current.id,timeLeft:0}},c()}});return u&&(r.current={...r.current,[a]:{timeoutId:u,timeLeft:s}}),()=>{clearTimeout(Ae()(r.current,`${a}.timeoutId`)),r.current=Se()(r.current,a)}}),[]),getValue:Object(n.useCallback)((()=>e=>{const t=pe.a.getId(e);return Ae()(r.current,`${t}.timeLeft`,0)}),[])}})(),{getValue:C,subscribe:p}=ze();return{getValue:Object(n.useCallback)((()=>({[le.a.CURRENT_URL]:e(),[le.a.TOTAL_TIME_SPENT]:r(),[le.a.ACTIVE_TIME_SPENT]:a(),[le.a.INACTIVE_TIME_SPENT]:i(),[le.a.INTERCEPT_ENGAGED_IN_SESSION_KEY]:b(),[le.a.INTERCEPT_CLOSED_IN_SESSION_KEY]:o(),[le.a.VERTICAL_PAGE_SCROLL_DEPTH]:E(),[le.a.HORIZONTAL_PAGE_SCROLL_DEPTH]:v(),[le.a.TIME_SPENT_ON_SESSION]:j(),[le.a.NUM_SNOOZE_ALLOWED]:g(),[le.a.BUSINESS_HOURS]:C()})),[e,r,a,i,o,b,E,v,j,g,C]),subscribe:Object(n.useCallback)(((e,r,n)=>{switch(pe.a.getField(e)){case le.a.TOTAL_TIME_SPENT:return c(e,r);case le.a.CURRENT_URL:return t(e,r);case le.a.ACTIVE_TIME_SPENT:return s(e,r);case le.a.INACTIVE_TIME_SPENT:return u(e,r);case le.a.INTERCEPT_CLOSED_IN_SESSION_KEY:return l(e,r);case le.a.INTERCEPT_ENGAGED_IN_SESSION_KEY:return O(e,r);case le.a.DEPENDENT_DURATION_KEY:return d(e,r,n);case le.a.VERTICAL_PAGE_SCROLL_DEPTH:return T(e,r);case le.a.HORIZONTAL_PAGE_SCROLL_DEPTH:return _(e,r);case le.a.TIME_SPENT_ON_SESSION:return I(e,r);case le.a.NUM_SNOOZE_ALLOWED:return h(e,r);case le.a.BUSINESS_HOURS:return p(e,r);default:return ee.a}}),[t,c,s,u,l,O,d,T,_,I,h,p])}},Je=r(304);var Xe=(e,t)=>{const{getValue:r,subscribe:c}=Ke(),a=Object(n.useCallback)((()=>{var e,n;return{...null!==(e=null===t||void 0===t||null===(n=t._getStaticValueMap)||void 0===n?void 0:n.call(t))&&void 0!==e?e:Je.a,...r()}}),[r,null===t||void 0===t?void 0:t._getStaticValueMap]);return Object(Ce.a)(e,{...t,getValue:a,subscribe:c})},qe=r(364),et=r.n(qe);var tt=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=Object(k.b)();return Object(n.useMemo)((()=>{o()(e)?c.current=[{hasPassed:!0}]:c.current=ue()(e,(e=>{let{id:t,filter:r}=e;const n=o()(r)||a.current[t];return delete a.current[t],{hasPassed:n}}))}),[e]),Object(n.useEffect)((()=>{if(!o()(_e()(ue()(e,"filter")))){const t=et.a.v4(),n=t=>{let{data:n}=t;n&&(c.current=ue()(e,((e,t)=>{var r,c;let{id:s,filter:i}=e;return a.current[s]=!i||(null===(r=n.results)||void 0===r||null===(c=r[t])||void 0===c?void 0:c.passed),{hasPassed:a.current[s]}})),r((e=>e+1)))};return s.sprChat("addFilterToEvaluate",{id:t,filters:ue()(e,"filter")},n),()=>{s.sprChat("removeFilterToEvaluate",{id:t})}}}),[e]),c.current};var rt=e=>{const t=Object(n.useRef)([]),r=ce(),{interceptsWithoutLiveChatFilterToEvaluate:c,interceptsOnlyWithLiveChatFilterToEvaluate:a}=Object(n.useMemo)((()=>Te()(e,((e,t)=>{const r=he(P.a.getFilter(t),Ie),n=he(P.a.getFilter(t),ge);return{interceptsWithoutLiveChatFilterToEvaluate:[...e.interceptsWithoutLiveChatFilterToEvaluate,r],interceptsOnlyWithLiveChatFilterToEvaluate:[...e.interceptsOnlyWithLiveChatFilterToEvaluate,{id:P.a.getId(t),filter:n}]}}),{interceptsWithoutLiveChatFilterToEvaluate:[],interceptsOnlyWithLiveChatFilterToEvaluate:[]})),[e]),s=Xe(c,{defaultValue:!0}),i=tt(a);return Object(n.useMemo)((()=>{t.current=[],ue()(e,((e,r)=>{s[r].hasPassed&&i[r].hasPassed&&(t.current=[...t.current,e])}))}),[s,i,e]),Object(n.useEffect)((()=>{const e=b()(t.current,(e=>!P.a.getCreativeId(e)));o()(e)||r.debug(`filterPassedIntercepts : ${JSON.stringify(e)}`)}),[t.current]),t.current},nt=r(462);const ct=(e,t)=>t?Te()(P.a.getTargets(e),((e,r,n)=>({...e,[n]:{...r,additional:t[r.value]}})),{}):P.a.getTargets(e);var at=r(319);const st="/livechat/prompt";async function it(e){return(await at.a.post(`${st}/creative/${e}`)).data}async function ut(e){return(await at.a.post(`${st}/fetch/survey`,e)).data}const ot=["snoozeConfig"];var lt=e=>{const[t,r]=Object(n.useState)(0),c=Object(n.useRef)([]),a=Object(n.useRef)({}),s=ce();return Object(n.useMemo)((()=>{c.current=[],ue()(e,(e=>{if(!e)return;if(!P.a.getCreativeId(e))return void s.debug(`Intercept resolver : ${JSON.stringify(e)}`);if(!o()(a.current[P.a.getId(e)]))return void c.current.push({...e,...Se()(a.current[P.a.getId(e)],ot)});const t=(e=>{const t=P.a.getId(e),r=Te()(P.a.getTargets(e),((e,t)=>t.type===nt.a.SURVEY||t.type===nt.a.SURVEY_INLINE?{...e,surveyURLs:e.surveyURLs?[...e.surveyURLs,t.value]:[t.value]}:e),{});return o()(r)?void 0:{...r,variantId:t}})(e);Promise.all([it(P.a.getCreativeId(e)),t?ut(t):Promise.resolve(void 0)]).then((t=>{let[n,s]=t;const i={...e,creative:n,targets:ct(e,s)};a.current[P.a.getId(e)]=i,c.current=[...c.current,i],r((e=>e+1))})).catch((e=>{Object(Y.b)(e)}))}))}),[e,r]),c.current};var bt=e=>{const t=Object(n.useRef)([]),r=rt(e),c=lt(r);return Object(n.useMemo)((()=>{t.current=d()([...de()(t.current,c,"id"),...c],"id")}),[c]),t.current},Ot=r(603);const dt=new Set([nt.a.LIVE_CHAT_EXECUTE_RULE,nt.a.LIVE_CHAT_ROUTE_TO_BOT,nt.a.LIVE_CHAT_WITH_AGENT,nt.a.CHAT_WITH_AGENT,nt.a.ROUTE_TO_BOT,nt.a.EXECUTE_RULE]);var Et=e=>{const[t,r]=Object(n.useState)([]),c=Object(k.b)();return Object(n.useEffect)((()=>{const t=t=>{const n=t?e:(e=>Te()(e,((e,t)=>{let r=!1;return Ve()(P.a.getTargets(t),(e=>{if(dt.has(Ot.a.getType(e)))return r=!0,!1})),r?e:[...e,t]}),[]))(e);r((e=>d()([...de()(e,n,"id"),...n],"id")))};return c.sprChat("onAvailabilityChange",t),()=>{c.sprChat("offAvailabilityChange",t)}}),[r,e,c]),t};const Tt="REMOVE_INTERCEPT";var vt=function(){const[e,t]=se(),r=be(e),c=bt(r);return[Et(c),Object(n.useCallback)((e=>{e.type===Tt&&t({type:w,payload:{interceptIds:[e.payload.interceptId]}})}),[])]},_t=r(270),jt=r(880),It=r(281);const gt="POPUP",ht="LIVECHAT",Ct="POSITIONED_POPUP",pt=Object(It.a)((()=>r.e(52).then(r.bind(null,1977)))),ft=Object(It.a)((()=>r.e(53).then(r.bind(null,1967)))),mt=Object(It.a)((()=>r.e(45).then(r.bind(null,1978)))),St=new Set([gt,ht,Ct]),Rt=e=>{const{intercepts:t}=e,r=Object(n.useMemo)((()=>Te()(t,((e,t)=>{const r=jt.a.getType(P.a.getCreative(t));return St.has(r)&&e[r].push(t),e}),{[gt]:[],[ht]:[],[Ct]:[]})),[t]),a=r[gt],s=r[Ct],u=r[ht];return Object(i.jsx)(c.a.Fragment,null,o()(a)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(pt,Object(_t.a)({},e,{intercepts:a}))),o()(u)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(mt,Object(_t.a)({},e,{intercepts:u}))),o()(s)?null:Object(i.jsx)(n.Suspense,{fallback:null},Object(i.jsx)(ft,Object(_t.a)({},e,{intercepts:s}))))};var yt=c.a.memo(Rt);var Nt=()=>{const[e,t]=vt(),r=Object(n.useCallback)((e=>{t({type:Tt,payload:{interceptId:e}})}),[t]);return o()(e)?null:Object(i.jsx)(yt,{intercepts:e,onClose:r})},At=r(881),Lt=r(1058);var kt=function(e){const t=Object(Lt.a)(e.window);return Object(i.jsx)(At.a.Provider,{value:t},e.children)},Pt=r(1118),Dt=r(852);var Ut=class{constructor(){this._map=void 0,this._map={}}addEntry(e){this._map[e]||(this._map[e]={subscribers:[],variants:[]})}setAction(e,t){const r=(e=>{const t=e.indexOf("_");return-1!==t?e.substring(0,t):e})(e),n=Date.now();this.addEntry(r),this._map[r].variants=[...this._map[r].variants,{actionState:t,actionTime:n,id:e}],this._map[r].subscribers.forEach((e=>{e(t)})),this._map[r].subscribers=[]}setSubscriber(e,t){return this.addEntry(e),this._map[e].subscribers.push(t),()=>{this._map[e].subscribers=this._map[e].subscribers.filter((e=>e!==t))}}getActionState(e,t){const r=this._map[e]&&this._map[e].variants;if(r&&r.length){const e=r.find((e=>e.id===t));return t?e&&e.actionState:r[r.length-1].actionState}}getActionDetails(){return this._map}};var Vt=()=>Object(n.useRef)(new Ut).current,wt=r(591);const Gt=e=>{const t=Object(k.b)(),r=Vt(),c=Object(n.useMemo)((()=>Object(wt.a)(t.document)),[t.document]);return Object(i.jsx)(i.CacheProvider,{value:c},Object(i.jsx)(kt,{window:t},Object(i.jsx)(Pt.a.Provider,{value:e.handshakeDetails},Object(i.jsx)(v.a.Provider,{value:r},Object(i.jsx)(ne,null,Object(i.jsx)(Dt.b,null,Object(i.jsx)(Nt,null)))))))};var Mt=c.a.memo(Gt),xt=r(1029);function Ht(e,t){const r=Object(xt.a)();s.a.render(Object(i.jsx)(Mt,{handshakeDetails:t}),r)}},320:function(e,t,r){"use strict";var n=r(262),c=r(377),a=r.n(c);const s="DATA_LOADING",i="DATA_LOADED",u="DATA_UPDATED",o="DATA_LOAD_FAILED",l="DATA_FETCHING_MORE",b={loading:!1,error:void 0,data:void 0},O=(e,t)=>{switch(t.type){case s:return{...e,loading:!0,data:void 0,error:void 0};case l:return{...e,loading:!0,error:void 0};case i:return{...e,loading:!1,data:t.payload};case o:return{...e,loading:!1,error:t.payload};case u:return{...e,data:t.payload};default:return e}};var d=()=>Object(n.useReducer)(O,b),E=r(293),T=r(319);const v=(e,t)=>t!==e.current;t.a=e=>{let{query:t,skipQueryOnMount:r,payload:c,onCompleted:b,options:O}=e;const[_,j]=d(),{loading:I,data:g,error:h}=_,C=Object(n.useRef)(null),p=Object(n.useRef)(g);p.current=g;const f=E.a.getType(t),m=E.a.getUrl(t),S=Object(n.useRef)(b);S.current=b;const R=Object(n.useCallback)((()=>{C.current=null}),[]),y=Object(n.useCallback)((async(e,t)=>{R(),C.current=t;const r=await T.a[f](m,e,O);if(!v(C,t))return S.current&&S.current(r.data),r}),[f,m]),N=Object(n.useCallback)((async e=>{j({type:s,payload:{}});const t=a()("reqId");try{const r=await y(e,t);v(C,t)||j({type:i,payload:r.data})}catch(r){v(C,t)||j({type:o,payload:r})}}),[y]);Object(n.useEffect)((()=>{r||N(c)}),[]);const A=Object(n.useCallback)((async(e,t)=>{j({type:l,payload:{}});const r=a()("reqId");try{const n=await y(e,r);if(!v(C,r)){let e=n.data;t&&(e=t(p.current,n.data)),j({type:i,payload:e})}}catch(n){v(C,r)||j({type:o,payload:n})}}),[y]),L=Object(n.useCallback)((async(e,t)=>{t?await A(e,t):await N(e)}),[N]),k=Object(n.useCallback)((e=>{j({type:u,payload:e(p.current)})}),[]);return{loading:I,data:g,error:h,refetch:L,fetchMore:A,updateQuery:k}}},387:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={PAGE_VISIT:"PAGE_VISIT",TAB_CHANGE:"TAB_CHANGE",TAB_CLOSE:"TAB_CLOSE",INTERCEPT_SNOOZE_TRIGGERED:"INTERCEPT_SNOOZE_TRIGGERED",INTERCEPT_TRIGGERED:"INTERCEPT_TRIGGERED",INTERCEPT_CLOSED:"INTERCEPT_CLOSED",INTERCEPT_ENGAGED:"INTERCEPT_ENGAGED",SNOOZE:"SNOOZE",INTERCEPT_TRIGGERED_IN_BACKGROUND:"INTERCEPT_TRIGGERED_IN_BACKGROUND",INTERCEPT_AUTO_CLOSED:"INTERCEPT_AUTO_CLOSED"}},398:function(e,t,r){"use strict";r.d(t,"a",(function(){return E}));var n=r(1984),c=r(1980),a=r(1882);const s=Object(n.a)("id"),i=Object(n.a)("creativeId"),u=Object(n.a)("targets"),o=Object(c.a)(["creative","socialAsset","content"]),l=Object(n.a)("settings"),b=Object(n.a)("filter"),O=Object(n.a)("snoozeConfig"),d=Object(c.a)(["additional","surveyResponseId"]);class E{}E.getId=Object(a.a)(s),E.getCreativeId=Object(a.a)(i),E.getTargets=Object(a.a)(u),E.getCreative=Object(a.a)(o),E.getFilter=Object(a.a)(b),E.getSettings=Object(a.a)(l),E.getSnoozeConfig=Object(a.a)(O),E.getSurveyResponseId=Object(a.a)(d)},426:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={CLOSE:"CLOSE",ENGAGE:"ENGAGE",TRIGGERED:"TRIGGERED",SNOOZE:"SNOOZE"}},461:function(e,t,r){"use strict";var n=r(262);const c=r.n(n).a.createContext(void 0);t.a=c},462:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));const n={LIVE_CHAT_ROUTE_TO_BOT:"LIVE_CHAT_ROUTE_TO_BOT",LIVE_CHAT_EXECUTE_RULE:"LIVE_CHAT_EXECUTE_RULE",LIVE_CHAT_WITH_AGENT:"LIVE_CHAT_WITH_AGENT",CLOSE:"CLOSE",SURVEY:"SURVEY",SURVEY_INLINE:"SURVEY_INLINE",CHAT_WITH_AGENT:"CHAT_WITH_AGENT",ROUTE_TO_BOT:"ROUTE_TO_BOT",EXECUTE_RULE:"EXECUTE_RULE",REMOVE:"REMOVE",SNOOZE:"SNOOZE",URL:"OPEN_URL"}},503:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(262),c=r(315);const a=()=>{const[e,t]=Object(n.useState)(Object(c.d)());return Object(n.useEffect)((()=>{const e=()=>{const e=Object(c.d)();e||t(!1),e&&t(!0)};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}}),[]),e}},602:function(e,t,r){"use strict";var n=r(262),c=r(40),a=r.n(c),s=r(452),i=r.n(s),u=r(380),o=r.n(u),l=r(320),b=r(503),O=r(879),d=r(293),E=r(337),T=r(313),v=r(387);const _=(new d.a).setUrl("/livechat/prompt/browse/event").setType(T.a.POST).build(),j=(()=>{const e={};return{set:(t,r)=>{e[r]=t},get:t=>e[t],push:(t,r)=>{var n;e[r]=[...null!==(n=e[r])&&void 0!==n?n:[],...o()(t)]}}})(),I=e=>({...e,sourceType:"PROACTIVE_PROMPT",page:Object(E.a)().pageUrl,timeZone:Object(E.a)().timeZone,userAgent:Object(E.a)().userAgent});t.a=function(){let{skipQueryOnMount:e,payload:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skipQueryOnMount:!1};const{refetch:r,...c}=Object(l.a)({query:_,skipQueryOnMount:e,payload:t?I(t):void 0}),s=Object(O.a)(),u=s.chatUser.userId,o=Object(b.a)(),d=Object(n.useRef)(o);d.current=o;const E=Object(n.useCallback)((e=>{const t=I(e);if(d.current)r(t);else if(t.eventType===v.a.INTERCEPT_AUTO_CLOSED){const e=i()(j.get(u),(e=>e.eventId===t.eventId&&e.eventType===v.a.INTERCEPT_TRIGGERED));-1!==e&&j.get(u).splice(e,1),j.push(t,u)}else t.eventType===v.a.INTERCEPT_TRIGGERED&&r({...t,eventType:v.a.INTERCEPT_TRIGGERED_IN_BACKGROUND}),j.push(t,u)}),[r,u]);return Object(n.useEffect)((()=>{o&&!a()(j.get(u))&&window.setTimeout((()=>{a()(j.get(u))||(r(j.get(u)),j.set([],u))}),0)}),[o]),{...c,refetch:E}}},603:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(1984),c=r(1882);const a=Object(n.a)("type"),s=Object(n.a)("value"),i=Object(n.a)("additional");class u{}u.getType=Object(c.a)(a),u.getValue=Object(c.a)(s),u.getAdditional=Object(c.a)(i)},879:function(e,t,r){"use strict";var n=r(262),c=r(1118);t.a=()=>Object(n.useContext)(c.a)},880:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(1984),c=r(1882);const a=Object(n.a)("type");class s{}s.getType=Object(c.a)(a)},881:function(e,t,r){"use strict";var n=r(262);const c=r.n(n).a.createContext({height:0,width:0});t.a=c}}]);